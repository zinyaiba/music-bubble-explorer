npm run dev# Implementation Plan

- [x] 1. 環境検出システムの実装

  - EnvironmentDetectorクラスの作成
  - 開発/本番環境の自動判別ロジック実装
  - EnvironmentConfigインターフェースの定義
  - URLパラメータによるデバッグモード強制機能
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 2. デバッグUI制御システムの実装

  - DebugUIコンポーネントの作成
  - 環境に応じたFPS表示の制御
  - ResetStatusボタンの条件付き表示
  - 開発用コンソールログの環境別制御
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [x] 3. 人物統合システムの実装

  - PersonConsolidatorクラスの作成
  - 同一人物の複数役割検出ロジック
  - ConsolidatedPersonインターフェースの実装
  - 統合された人物の関連楽曲数計算
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 4. シャボン玉レジストリシステムの実装

  - BubbleRegistryクラスの作成
  - 表示中コンテンツの追跡機能
  - 重複防止のための一意性チェック
  - 利用可能コンテンツプールの管理
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 5. 視覚的区別システムの基盤実装

  - EnhancedBubbleインターフェースの定義
  - VisualThemeとBubbleStyleの実装
  - IconTypeとShapeTypeの列挙型定義
  - 基本的な色彩システムの実装
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [x] 6. アイコンレンダリングシステムの実装

  - IconRendererクラスの作成
  - 音符アイコンの描画実装
  - ペンアイコンの描画実装
  - 楽譜アイコンの描画実装
  - ミキサーアイコンの描画実装
  - ハッシュタグアイコンの描画実装
  - 複数役割アイコンの描画実装
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x] 7. 形状レンダリングシステムの実装

  - ShapeRendererクラスの作成
  - 円形の描画実装
  - 角丸四角形の描画実装
  - 六角形の描画実装
  - ダイヤモンド形の描画実装
  - 星形の描画実装
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 8. 拡張バブルマネージャーの実装

  - EnhancedBubbleManagerクラスの作成
  - 既存BubbleManagerからの継承と拡張
  - 一意なシャボン玉生成ロジック
  - 視覚スタイルの適用機能
  - アイコン付きシャボン玉の描画統合
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 9. 複数役割シャボン玉の特殊表示実装

  - 複数役割の検出と統合ロジック
  - 複合グラデーションの生成
  - 複合アイコンの描画
  - 特殊形状（星形・ダイヤモンド）の適用
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 5.6_

- [x] 10. 重複防止アルゴリズムの実装

  - ContentTrackerクラスの作成
  - 表示中アイテムの追跡機能
  - 利用可能コンテンツプールの管理
  - 重み付き選択アルゴリズム
  - 回転戦略の実装
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 11. 既存システムとの統合

  - 既存BubbleCanvasコンポーネントの拡張
  - MusicDataServiceとの連携強化
  - 既存のシャボン玉ライフサイクルとの統合
  - DetailModalの複数役割対応
  - _Requirements: 1.1, 2.3, 3.1_

- [x] 12. パフォーマンス最適化の実装

  - アイコンキャッシュシステム
  - 形状描画の最適化
  - グラデーションパターンのキャッシュ
  - 選択的レンダリングの実装
  - _Requirements: 1.1, 5.1_

- [x] 13. エラーハンドリングとフォールバック機能





  - アイコン描画失敗時のフォールバック
  - 色彩適用エラーの処理
  - 人物統合エラーの処理
  - レジストリエラーの処理
  - _Requirements: 1.1, 2.1, 3.1_

- [x] 14. 統合テストと品質保証





  - 視覚的区別の動作確認
  - 重複防止機能のテスト
  - 環境別UI表示のテスト
  - 複数役割統合の動作確認
  - パフォーマンステストの実行
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1_

- [ ]* 14.1 ユニットテストの作成
  - PersonConsolidatorのテスト
  - BubbleRegistryのテスト
  - EnvironmentDetectorのテスト
  - IconRendererのテスト
  - ShapeRendererのテスト
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1_

- [x] 15. 最終統合と調整





  - 全機能の統合確認
  - 既存機能との互換性確認
  - UI/UXの最終調整
  - モバイル対応の確認
  - GitHub Pages対応の確認
  - _Requirements: 1.1, 2.1, 3.1, 4.1, 5.1_