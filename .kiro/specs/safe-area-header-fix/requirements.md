# 要件ドキュメント

## はじめに

本機能は、iOS/Android各種ブラウザ（Safari、Chrome等）において、ノッチやURLバーによってヘッダーが隠れてしまう問題を根本的に解決するものである。特にURLバーが上部に表示されるタイプのブラウザで、戻るボタンなどのヘッダー要素が操作不能になる事象に対応する。

### 対象となる問題のある環境
- iOS（一部機種） × Chrome（URLバーが上にあるタイプ） → ヘッダーが埋もれる
- iOS（一部機種） × Safari（URLバーが上にあるタイプ） → ヘッダーが埋もれる
- Android × Chrome（URLバーが上にあるタイプ） → ヘッダーが埋もれる

## 用語集

- **セーフエリア（Safe Area）**: ノッチ、ホームインジケーター、URLバーなどのシステムUIに重ならない、コンテンツを安全に表示できる領域
- **env(safe-area-inset-*)**: CSSの環境変数で、デバイスのセーフエリアのインセット値を取得する
- **viewport-fit=cover**: ビューポートをデバイスの全画面に拡張し、セーフエリア対応を有効にするmeta設定
- **dvh（動的ビューポート高さ）**: ブラウザのUIバーの表示/非表示に応じて動的に変化するビューポート高さ単位
- **svh（小ビューポート高さ）**: ブラウザのUIバーが表示されている状態での最小ビューポート高さ
- **lvh（大ビューポート高さ）**: ブラウザのUIバーが非表示の状態での最大ビューポート高さ
- **ヘッダーコンポーネント**: アプリケーションのヘッダー領域を表示するReactコンポーネント
- **メインコンテンツ領域**: ヘッダーとナビゲーション以外のメインコンテンツ領域

## 要件

### 要件1：モバイルヘッダーの可視性確保

**ユーザーストーリー:** モバイルユーザーとして、どのデバイスやブラウザを使っていても、ヘッダーが常に見えてアクセスできるようにしたい。これにより、ナビゲーションボタンを確実に操作できる。

#### 受け入れ基準

1. アプリケーションがモバイルデバイスで読み込まれた時、ヘッダーコンポーネントはenv(safe-area-inset-top, 0px)以上のpadding-topを適用すること
2. ブラウザに上部URLバーがある時、ヘッダーコンポーネントはURLバーの下に完全に表示されること
3. ユーザーがページをスクロールした時、ヘッダーコンポーネントはセーフエリアに対する相対位置を維持すること
4. デバイスがsafe-area-insetをサポートしていない場合、ヘッダーコンポーネントはモバイルデバイスで最小20pxのフォールバックパディングを適用すること

### 要件2：統一されたセーフエリア処理システム

**ユーザーストーリー:** 開発者として、統一されたセーフエリア処理システムが欲しい。これにより、すべてのコンポーネントが一貫してデバイスのセーフエリアを尊重できる。

#### 受け入れ基準

1. フルスクリーンオーバーレイやモーダルが開いた時、システムはオーバーレイヘッダーにsafe-area-inset-topパディングを適用すること
2. StandardLayoutコンポーネントがレンダリングされた時、システムはヘッダー位置にsafe-area-inset-topを含めること
3. セーフエリア用のCSS変数が定義された時、システムはすべてのコンポーネントで一貫した変数名を使用すること
4. コンポーネントがセーフエリア値を必要とする時、システムは集中管理されたCSSカスタムプロパティシステムを提供すること

### 要件3：様々なビューポート設定への適応

**ユーザーストーリー:** 様々なデバイスのユーザーとして、レイアウトが異なるビューポート設定に正しく適応してほしい。これにより、コンテンツがシステムUIに隠れることがない。

#### 受け入れ基準

1. ビューポートがviewport-fit=coverを使用する時、html要素は正しく設定されたviewport metaタグを持つこと
2. フルスクリーン高さを計算する時、システムは古いブラウザ向けのvhフォールバック付きでdvh単位を使用すること
3. 下部ナビゲーションがレンダリングされる時、システムはenv(safe-area-inset-bottom, 0px)に等しいpadding-bottomを適用すること
4. 横向きが検出された時、システムはsafe-area-inset-leftとsafe-area-inset-rightを適切に適用すること

### 要件4：iPhoneノッチ/Dynamic Island対応

**ユーザーストーリー:** ノッチやDynamic Islandを持つiPhoneのユーザーとして、ヘッダーコンテンツがノッチ領域の下に配置されてほしい。これにより、すべてのヘッダー要素を操作できる。

#### 受け入れ基準

1. デバイスにノッチまたはDynamic Islandがある時、ヘッダーコンポーネントのコンテンツはノッチ領域の下に配置されること
2. ヘッダーにインタラクティブ要素が含まれる時、すべてのインタラクティブ要素はセーフエリア内にあること
3. safe-area-inset-top値が変更された時（例：向き変更）、ヘッダーコンポーネントはパディングを動的に更新すること
4. JavaScriptでのセーフエリア検出が必要な場合、システムはCSS.supports()またはgetComputedStyle()を使用してサポートを検出すること

### 要件5：Android Chrome URLバー対応

**ユーザーストーリー:** 上部URLバーのあるAndroid Chromeのユーザーとして、ヘッダーがブラウザクロームを考慮してほしい。これにより、ヘッダーがURLバーの後ろに隠れない。

#### 受け入れ基準

1. アプリケーションがAndroid Chromeで実行される時、ヘッダーコンポーネントはブラウザのURLバーの高さを考慮すること
2. URLバーが展開状態の時、ヘッダーコンテンツは完全に表示されたままであること
3. Androidで100vhを使用する時、システムは代替単位（dvh、svh）またはJavaScriptベースの高さ計算を使用すること
4. キーボードが表示された時、レイアウトはヘッダー位置を壊さずに調整すること

### 要件6：テスト可能性とフォールバック

**ユーザーストーリー:** 開発者として、異なるデバイス間でセーフエリア処理をテストしたい。これにより、実装が正しく動作することを確認できる。

#### 受け入れ基準

1. セーフエリア実装をテストする時、システムは開発モードでセーフエリア境界の視覚的インジケーターを提供すること
2. ブラウザがenv()をサポートしていない時、システムはフォールバック値に優雅にデグレードすること
3. CSS @supportsが使用される時、システムはsafe-area-insetサポートを正しく検出すること
4. 実装が完了した時、システムはiOS Safari、iOS Chrome、Android Chrome、デスクトップブラウザで動作すること

