# 要件定義書

## はじめに

タグ一覧画面から、ユーザーがおすすめのタグをX（旧Twitter）で共有できる機能を実装する。Xアプリとの自動連携は行わず、共有用テキストをクリップボードにコピーしてユーザーが手動でXに貼り付ける方式とする。また、共有されたリンクをクリックすると、そのタグに紐づく楽曲一覧が表示されるディープリンク機能も提供する。

## 用語集

- **タグ共有システム**: タグをSNSで共有するための機能を提供するシステム
- **共有テキスト生成器**: X投稿用のテキストを生成するコンポーネント
- **ディープリンクハンドラー**: URLパラメータからタグ情報を読み取り、該当タグの詳細画面を表示するコンポーネント
- **クリップボードサービス**: テキストをクリップボードにコピーする機能を提供するサービス
- **タグ詳細画面**: タグに紐づく楽曲一覧を表示する画面

## 要件

### 要件1: 共有ボタンの表示

**ユーザーストーリー:** ユーザーとして、タグ一覧の各タグに共有ボタンが表示されることで、お気に入りのタグを簡単に共有したい。

#### 受け入れ条件

1. タグ一覧が表示されたとき、タグ共有システムは各タグアイテムに共有ボタン（🔗または類似アイコン）を表示する
2. モバイルデバイスの場合、タグ共有システムはタッチしやすいサイズ（最小44x44pxのタップ領域）で共有ボタンを表示する
3. タグ共有システムは、タグ詳細表示のクリック操作を妨げない位置に共有ボタンを配置する

### 要件2: 共有テキストの生成

**ユーザーストーリー:** ユーザーとして、タグ名とリンクを含むX用の共有テキストを生成することで、フォロワーにそのタグの楽曲を紹介したい。

#### 受け入れ条件

1. ユーザーが共有ボタンをクリックしたとき、共有テキスト生成器はハッシュタグ付きのタグ名（例：「#ロック」）を含むテキストを作成する
2. 共有テキスト生成器は、特定のタグを選択した状態でアプリを開くディープリンクURLを含める
3. 共有テキスト生成器は、簡潔な説明文（例：「みな実さんの楽曲を「#タグ名」で探してみよう！」）を含める
4. 共有テキスト生成器は、テキスト全体の長さがXの制限（280文字）を超えないようにする
5. 共有テキスト生成器は、特殊文字を処理するためにディープリンク内のタグ名をURLエンコードする

### 要件3: クリップボードへのコピー

**ユーザーストーリー:** ユーザーとして、ワンタップで共有テキストをクリップボードにコピーすることで、簡単にXに貼り付けたい。

#### 受け入れ条件

1. 共有ボタンがクリックされたとき、クリップボードサービスは生成された共有テキストをクリップボードにコピーする
2. コピーが成功したとき、タグ共有システムは成功通知（例：「コピーしました！Xに貼り付けてね」）を表示する
3. クリップボードAPIが利用できない場合、タグ共有システムは手動コピー用の共有テキストとともにエラーメッセージを表示する
4. タグ共有システムは、成功通知を3秒後に自動的に非表示にする

### 要件4: ディープリンクの処理

**ユーザーストーリー:** ユーザーとして、共有されたリンクをクリックしてそのタグに関連する楽曲を見ることで、新しい音楽を発見したい。

#### 受け入れ条件

1. アプリがURLにタグパラメータ（例：?tag=ロック または #tag=ロック）を含んで読み込まれたとき、ディープリンクハンドラーはタグ名を解析する
2. 有効なタグパラメータが見つかったとき、ディープリンクハンドラーはそのタグのタグ詳細画面を自動的に開く
3. タグパラメータが無効または存在しないタグの場合、ディープリンクハンドラーは「タグが見つかりませんでした」というメッセージを表示し、メイン画面を表示する
4. ディープリンクハンドラーは、特殊文字を正しく処理するためにタグパラメータをURLデコードする
5. ディープリンク経由でタグ詳細画面が開かれたとき、タグ詳細画面はそのタグに関連するすべての楽曲を表示する

### 要件5: 共有リンクのフォーマット

**ユーザーストーリー:** 開発者として、共有リンクのフォーマットが一貫性があり信頼性が高いことで、ユーザーが常に正しいタグにアクセスできるようにしたい。

#### 受け入れ条件

1. 共有テキスト生成器は、`{ベースURL}?tag={エンコードされたタグ名}` の形式でリンクを生成する
2. 共有テキスト生成器は、現在のデプロイURLをベースURLとして使用する
3. 共有テキスト生成器は、エンコード/デコード時にタグ名を正確に保持する（ラウンドトリップの一貫性）
4. すべての有効なタグ名について、エンコードしてからデコードすると元のタグ名が得られる

### 要件6: モバイル対応

**ユーザーストーリー:** モバイルユーザーとして、外出先でもスムーズに共有機能を使いたい。

#### 受け入れ条件

1. Web Share APIをサポートするモバイルデバイスの場合、タグ共有システムはオプションでネイティブ共有機能を提供する
2. タグ共有システムは、すべてのタッチターゲットがアクセシビリティガイドライン（最小44x44px）を満たすようにする
3. タグ共有システムは、コピー成功時に触覚フィードバック（利用可能な場合）を提供する
