# 要件定義書

## はじめに

Music Bubble Explorer V2は、既存のMusic Bubble Explorerを機能を維持しつつ、パフォーマンス・レイアウト統一・クロスブラウザ対応を大幅に改善した新規プロジェクトとして再構築するものである。既存のFirebaseデータベースをそのまま活用し、データ構造の最適化も行う。

## プロジェクト構成

- 新規プロジェクトは既存プロジェクトとは完全に別のディレクトリに作成する
- 既存のソースコードは変更せず、そのまま残す
- 新規プロジェクトのディレクトリ名: `music-bubble-v2`（親ディレクトリに作成）
- 既存のFirebase設定を共有し、同じデータベースを参照する

## デプロイ構成

- 新規GitHubリポジトリ `music-bubble-v2` を作成
- GitHub Pagesで公開
- 公開URL: `https://[username].github.io/music-bubble-v2/`
- 既存サイト（`/music-bubble-explorer/`）はそのまま残す
- Firebaseデータベースは既存と共有（同じデータを参照）

## 用語集

- **システム**: Music Bubble Explorer V2アプリケーション全体
- **バブルキャンバス**: シャボン玉を表示・アニメーションするメインキャンバス領域
- **バブル**: 楽曲・アーティスト・タグなどを表すシャボン玉オブジェクト
- **楽曲**: 楽曲データ（タイトル、アーティスト、作詞家、作曲家、編曲家、タグ等）
- **タグ**: ユーザーが楽曲に付与するラベル
- **アーティスト**: 楽曲のアーティスト名
- **ジャンル**: 楽曲のジャンル分類
- **詳細ページ**: 楽曲の詳細情報を表示するページ
- **フィルタ**: データを絞り込むための条件指定機能
- **ナビゲーション**: ページ間の遷移を管理するコンポーネント
- **埋め込みコンテンツ**: iframe等で埋め込む外部コンテンツ（Spotify、YouTube等）

## 要件

### 要件1: TOPページ - シャボン玉表示

**ユーザーストーリー:** ユーザーとして、インタラクティブなシャボン玉を通じて楽曲情報を探索したい。楽曲や関連情報を楽しく発見できるようにするため。

#### 受け入れ基準

1. TOPページが読み込まれた時、バブルキャンバスは楽曲・アーティスト・タグを表すアニメーションするシャボン玉を表示すること
2. ユーザーがシャボン玉をタップした時、システムはそのシャボン玉の関連情報を表示すること
3. ユーザーが楽曲シャボン玉をタップした時、システムはその楽曲の詳細ページへの遷移を提供すること
4. バブルキャンバスはモバイル・デスクトップ両方で60fpsでスムーズに描画すること
5. データ読み込み中、システムはユーザー操作をブロックせずにローディングインジケータを表示すること

### 要件2: TOPページ - アニメーション制御

**ユーザーストーリー:** ユーザーとして、シャボン玉のアニメーションを制御したい。必要に応じてデバイスのリソース使用量を削減するため。

#### 受け入れ基準

1. システムはシャボン玉アニメーションの一時停止/再開ボタンを表示すること
2. ユーザーが一時停止ボタンをタップした時、バブルキャンバスは全てのシャボン玉アニメーションを即座に停止すること
3. ユーザーが再開ボタンをタップした時、バブルキャンバスは現在の位置からシャボン玉アニメーションを再開すること
4. アニメーションが一時停止中、システムはCPU/GPU使用量を大幅に削減すること
5. システムはアニメーション状態の設定をローカルストレージに保存すること

### 要件3: TOPページ - アーティストフィルタ（第1フィルタ）

**ユーザーストーリー:** ユーザーとして、アーティスト名でシャボン玉をフィルタリングしたい。特定のアーティストの楽曲に集中するため。

#### 受け入れ基準

1. システムはTOPページにアーティストフィルタセレクタを表示すること
2. システムは固定の3種類のアーティストフィルタオプションを提供すること：「栗林みな実」「Minami」「それ以外」
3. ユーザーが「栗林みな実」を選択した時、バブルキャンバスはアーティスト名に「栗林みな実」を含む楽曲のシャボン玉のみを表示すること
4. ユーザーが「Minami」を選択した時、バブルキャンバスはアーティスト名に「Minami」を含む楽曲のシャボン玉のみを表示すること
5. ユーザーが「それ以外」を選択した時、バブルキャンバスは「栗林みな実」「Minami」以外のアーティストの楽曲のシャボン玉を表示すること
6. アーティストが選択されていない時、バブルキャンバスは全アーティストのシャボン玉を表示すること

### 要件4: TOPページ - ジャンルフィルタ（第2フィルタ）

**ユーザーストーリー:** ユーザーとして、アーティスト選択後にジャンルでさらにフィルタリングしたい。特定の種類の楽曲に絞り込むため。

#### 受け入れ基準

1. システムは第2フィルタとして機能するジャンルフィルタセレクタを表示すること
2. アーティストフィルタがアクティブな時、ジャンルフィルタはそのアーティストの楽曲で利用可能なジャンルのみを表示すること
3. ユーザーがジャンルを選択した時、バブルキャンバスはアーティストとジャンル両方のフィルタに一致するシャボン玉のみを表示すること
4. ジャンルが選択されていない時、システムはアーティストフィルタに一致する全ての楽曲を表示すること
5. システムはアーティストフィルタが変更された時、ジャンルオプションを動的に更新すること

### 要件5: タグ登録ページ

**ユーザーストーリー:** ユーザーとして、楽曲にタグを登録したい。カスタムラベルで音楽を分類・整理するため。

#### 受け入れ基準

1. ユーザーがタグ登録ページに遷移した時、システムは全ての楽曲と現在のタグの一覧を表示すること
2. システムはタイトル、アーティスト、既存タグで楽曲をフィルタリングする検索機能を提供すること
3. ユーザーが楽曲をタップした時、システムはその楽曲のタグ入力インターフェースを表示すること
4. ユーザーがタグを追加した時、システムはタグを即座にデータベースに保存すること
5. ユーザーがタグを削除した時、システムは即座にデータベースを更新すること
6. システムはタグを視覚的に区別しやすく、読みやすい形式で表示すること

### 要件6: タグ一覧ページ

**ユーザーストーリー:** ユーザーとして、登録された全てのタグと関連楽曲を閲覧したい。タグで音楽を探索するため。

#### 受け入れ基準

1. ユーザーがタグ一覧ページに遷移した時、システムは全てのユニークなタグを表示すること
2. システムはタグ名でフィルタリングする検索機能を提供すること
3. ユーザーがタグをタップした時、システムはそのタグに関連する全ての楽曲を表示すること
4. システムは各タグの楽曲数を表示すること
5. システムはタグ情報をテキストとしてコピーするSNS共有機能を提供すること
6. システムはデフォルトでタグをアルファベット順にソートし、楽曲数でのソートオプションも提供すること

### 要件7: 楽曲一覧ページ

**ユーザーストーリー:** ユーザーとして、全ての楽曲を閲覧・検索・管理したい。楽曲情報を簡単に見つけて編集するため。

#### 受け入れ基準

1. ユーザーが楽曲一覧ページに遷移した時、システムは全ての楽曲をスクロール可能なリストで表示すること
2. システムはタイトル、アーティスト、作詞家、作曲家、編曲家で楽曲をフィルタリングする検索機能を提供すること
3. ユーザーが楽曲をタップした時、システムはその楽曲の詳細ページに遷移すること
4. システムは新規楽曲を追加するボタンを提供すること
5. システムは既存楽曲の編集機能を提供すること
6. システムは楽曲情報をコンパクトで見やすい形式で表示すること

### 要件8: 楽曲詳細ページ

**ユーザーストーリー:** ユーザーとして、埋め込みコンテンツを含む詳細な楽曲情報を閲覧したい。音楽サービスに直接アクセスするため。

#### 受け入れ基準

1. ユーザーが楽曲の詳細ページに遷移した時、システムは全ての楽曲メタデータを表示すること
2. システムは利用可能な場合、埋め込みコンテンツ（Spotify、YouTube等）をiframeで表示すること
3. システムは利用可能な場合、音楽サービスへの外部リンクを表示すること
4. システムは楽曲に関連する全てのタグを表示すること
5. システムは前のページに戻るナビゲーションを提供すること
6. システムは欠落または無効な埋め込みコンテンツを適切に処理すること

### 要件9: お知らせ・使い方ページ

**ユーザーストーリー:** ユーザーとして、ヘルプ情報とお知らせにアクセスしたい。アプリの使い方を学び、アップデート情報を把握するため。

#### 受け入れ基準

1. ユーザーがお知らせページに遷移した時、システムは使い方の説明を表示すること
2. システムは管理者からのお知らせとアップデート情報を表示すること
3. システムはお知らせを新しい順に表示すること
4. システムはお知らせコンテンツのマークダウン形式をサポートすること
5. システムはお知らせの既読状態をローカルストレージに保存すること

### 要件10: クロスブラウザ・クロスデバイス対応

**ユーザーストーリー:** ユーザーとして、全てのデバイスとブラウザで一貫してアプリを使用したい。どのプラットフォームでも使えるようにするため。

#### 受け入れ基準

1. システムはSafari（iOS/macOS）で正しく動作すること
2. システムはChrome（Android/Windows/macOS）で正しく動作すること
3. システムはiPhoneデバイスで正しく動作すること
4. システムはAndroidデバイスで正しく動作すること
5. システムは適切なフォールバックを持つ標準的なCSSとJavaScript機能のみを使用すること
6. ブラウザ固有の機能が利用できない場合、システムは適切なフォールバックを提供すること

### 要件11: レイアウト統一

**ユーザーストーリー:** ユーザーとして、全てのページで一貫したビジュアル体験を得たい。アプリが統一感があり、プロフェッショナルに感じられるようにするため。

#### 受け入れ基準

1. システムは全てのページで単一の統一されたデザインテーマを使用すること
2. システムは一貫したスペーシング、タイポグラフィ、カラースキームを使用すること
3. システムはTOPページにダイアログを重ねる代わりに、別のページに遷移すること
4. システムは全てのページで一貫したヘッダーとナビゲーションの配置を維持すること
5. システムは画面サイズに適応し、崩れないレスポンシブレイアウトを使用すること

### 要件12: パフォーマンス最適化

**ユーザーストーリー:** ユーザーとして、アプリが素早く読み込まれ、応答することを望む。ストレスなく使用するため。

#### 受け入れ基準

1. システムは標準的なモバイル接続で3秒以内に初期ページを読み込むこと
2. ユーザーがボタンをタップした時、システムは100ms以内に応答すること
3. システムは重要でないコンテンツの遅延読み込みを実装すること
4. システムはデータ更新時の再レンダリングを最小化すること
5. システムはフィルタリングと検索に効率的なデータ構造を使用すること
6. システムは頻繁にアクセスされるデータを適切にキャッシュすること

### 要件13: データ構造最適化

**ユーザーストーリー:** 開発者として、最適化されたデータ構造を望む。大規模なデータセットでもアプリが良好に動作するため。

#### 受け入れ基準

1. システムは既存のFirebaseデータベースを使用すること
2. システムはネットワークリクエストを最小化するようにデータクエリを最適化すること
3. システムは楽曲とタグデータのクライアントサイドキャッシュを実装すること
4. システムは大きなリストの増分データ読み込みをサポートすること
5. データ構造の変更が必要な場合、システムは既存データを損失なく移行すること

### 要件14: ナビゲーション

**ユーザーストーリー:** ユーザーとして、明確で一貫したナビゲーションを望む。ページ間を簡単に移動するため。

#### 受け入れ基準

1. システムは全てのページからアクセス可能なメインメニューを提供すること
2. システムはナビゲーションで現在のページをハイライトすること
3. システムはブラウザの戻る/進むナビゲーションをサポートすること
4. システムは全てのページでURLルーティングを使用すること
5. ページ間を遷移する時、システムは戻った時にスクロール位置を保持すること

### 要件15: エラーハンドリング

**ユーザーストーリー:** ユーザーとして、明確なエラーメッセージと回復オプションを望む。問題を理解し解決するため。

#### 受け入れ基準

1. ネットワークエラーが発生した時、システムはユーザーフレンドリーなエラーメッセージを表示すること
2. データ読み込みエラーが発生した時、システムはリトライオプションを提供すること
3. システムは機密情報を公開せずにデバッグ用にエラーをログに記録すること
4. Firebaseが利用できない場合、システムはキャッシュデータでオフラインモードで動作すること
5. システムはユーザー入力を検証し、明確な検証メッセージを表示すること

